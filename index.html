<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì§€ì•¤ë¯¸ìˆ ê´€</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{margin:0;padding:0;background:#000;color:#fff;font-family:sans-serif;}

/* ===== ìƒë‹¨ ì‹œê³„ ===== */
#clock{
  text-align:center;
  font-size:16px;
  padding:8px 0;
  background:#000;
  border-bottom:1px solid #222;
}

#rooms{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:10px;}

.room{
  background:#111;
  border:3px solid #333;
  border-radius:14px;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.room h3{margin:0;text-align:center;}

.room.active{ border-color:#ffeb3b; }
.room.warning{ border-color:#f44336; }
.room.extended{ border-color:#4caf50; }

.time{font-size:26px;text-align:center;font-weight:bold;}
.starttime{text-align:center;background:#222;border-radius:10px;padding:6px;}
.buttons{display:flex;gap:6px;}

button{
  flex:1;
  font-size:16px;
  padding:10px;
  border:none;
  border-radius:12px;
  font-weight:bold;
}
.start{background:#ff9800;color:#000;}
.extend{background:#4caf50;color:#000;}
.cancel{background:#f44336;color:#000;}

#timePicker{display:none;position:fixed;inset:0;background:#000c;}
#pickerBox{background:#222;margin:30% auto;width:280px;padding:20px;border-radius:16px;text-align:center;}
#pickerBox select{font-size:28px;}
</style>
</head>

<body>

<!-- ğŸ“… í˜„ì¬ ë‚ ì§œ / ì‹œê°„ -->
<div id="clock"></div>

<div id="rooms"></div>

<div id="timePicker">
  <div id="pickerBox">
    <select id="pickHour"></select> :
    <select id="pickMin"></select><br><br>
    <button onclick="applyTime()">ì ìš©</button>
    <button onclick="closePicker()">ì·¨ì†Œ</button>
  </div>
</div>

<script>
/* ===== ìƒë‹¨ ì‹œê³„ ===== */
function updateClock(){
  const d = new Date();
  const y = d.getFullYear();
  const m = d.getMonth()+1;
  const day = d.getDate();
  const h = d.getHours();
  const min = d.getMinutes();

  document.getElementById("clock").textContent =
    `${y}ë…„ ${String(m).padStart(2,'0')}ì›” ${String(day).padStart(2,'0')}ì¼ ` +
    `${String(h).padStart(2,'0')}ì‹œ ${String(min).padStart(2,'0')}ë¶„`;
}
updateClock();
setInterval(updateClock, 60000);

/* ===== ê¸°ì¡´ ë¡œì§ ===== */
const ROOM_COUNT=9;
const BASE_TIME=120*60*1000;
const WARN_BEFORE=10*60*1000;
const EXTEND_TIME=60*60*1000;

const rooms={};
let editingRoom=null;

function speak(t){
  const u=new SpeechSynthesisUtterance(t);
  u.lang="ko-KR";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function nowMs(){ return Date.now(); }

function nowLabel(){
  const d=new Date();
  let h=d.getHours()%12; if(h===0)h=12;
  return `${String(h).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}

function format(ms){
  const t=Math.max(0,Math.floor(ms/1000));
  return `${String(Math.floor(t/3600)).padStart(2,'0')}:${String(Math.floor(t%3600/60)).padStart(2,'0')}:${String(t%60).padStart(2,'0')}`;
}

/* ===== ì‹œì‘ ===== */
function startRoom(n){
  if(rooms[n]) return;
  rooms[n]={
    startBase: nowMs(),
    extend: 0,
    warned:false,
    timer:setInterval(()=>updateRoom(n),1000)
  };
  document.getElementById(`start${n}`).textContent=`ì‹œì‘ì‹œê°„ ${nowLabel()}`;
  document.getElementById(`room${n}`).classList.add("active");
  speak(`${n}ë£¸, ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤`);
}

/* ===== ì—…ë°ì´íŠ¸ ===== */
function updateRoom(n){
  const r=rooms[n]; if(!r)return;
  const elapsed = nowMs() - r.startBase;
  let remain = BASE_TIME + r.extend - elapsed;

  if(remain<=0){
    speak(`${n}ë£¸, ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤`);
    cancelRoom(n,false);
    return;
  }

  document.getElementById(`time${n}`).textContent=format(remain);

  if(!r.warned && remain<=WARN_BEFORE){
    r.warned=true;
    const roomEl=document.getElementById(`room${n}`);
    roomEl.classList.remove("active","extended");
    roomEl.classList.add("warning");
    speak(`${n}ë£¸, ë§ˆê° 10ë¶„ ì „ì…ë‹ˆë‹¤`);
  }
}

/* ===== ì‹œì‘ì‹œê°„ ìˆ˜ì • ===== */
function openTimePicker(n){
  editingRoom=n;
  const d=new Date();
  let h=d.getHours()%12; if(h===0)h=12;
  pickHour.value=h;
  pickMin.value=String(d.getMinutes()).padStart(2,'0');
  timePicker.style.display="block";
}

function applyTime(){
  const r=rooms[editingRoom];
  if(!r){closePicker();return;}

  const selH=parseInt(pickHour.value);
  const selM=parseInt(pickMin.value);

  const d=new Date();
  let curH=d.getHours()%12; if(curH===0)curH=12;
  const curM=d.getMinutes();

  const diffMin=(curH*60+curM)-(selH*60+selM);
  r.startBase = nowMs() - diffMin*60*1000;

  document.getElementById(`start${editingRoom}`).textContent=
    `ì‹œì‘ì‹œê°„ ${String(selH).padStart(2,'0')}:${String(selM).padStart(2,'0')}`;

  r.warned=false;
  closePicker();
}

function closePicker(){timePicker.style.display="none";}

/* ===== ì—°ì¥ ===== */
function extendRoom(n){
  if(!rooms[n])return;
  rooms[n].extend+=EXTEND_TIME;
  const roomEl=document.getElementById(`room${n}`);
  roomEl.classList.remove("active","warning");
  roomEl.classList.add("extended");
  speak(`${n}ë£¸, 1ì‹œê°„ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤`);
}

/* ===== ì·¨ì†Œ ===== */
function cancelRoom(n,voice=true){
  if(!rooms[n])return;
  clearInterval(rooms[n].timer);
  delete rooms[n];
  document.getElementById(`time${n}`).textContent="ëŒ€ê¸°";
  document.getElementById(`start${n}`).textContent="ì‹œì‘ì‹œê°„ --:--";
  document.getElementById(`room${n}`).classList.remove("active","warning","extended");
  if(voice)speak(`ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

/* ===== UI ===== */
const roomsDiv=document.getElementById("rooms");
for(let i=1;i<=ROOM_COUNT;i++){
  roomsDiv.innerHTML+=`
  <div class="room" id="room${i}">
    <h3>${i}ë£¸</h3>
    <div class="time" id="time${i}">ëŒ€ê¸°</div>
    <div class="starttime" id="start${i}" onclick="openTimePicker(${i})">ì‹œì‘ì‹œê°„ --:--</div>
    <div class="buttons">
      <button class="start" onclick="startRoom(${i})">ì‹œì‘</button>
      <button class="extend" onclick="extendRoom(${i})">+1h</button>
      <button class="cancel" onclick="cancelRoom(${i})">ì·¨ì†Œ</button>
    </div>
  </div>`;
}
for(let i=1;i<=12;i++)pickHour.innerHTML+=`<option>${i}</option>`;
for(let i=0;i<60;i++)pickMin.innerHTML+=`<option>${String(i).padStart(2,'0')}</option>`;
</script>
</body>
</html>
